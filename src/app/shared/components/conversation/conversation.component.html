<div class="timeSeperator">
  <img class="line" src="./assets/img/auth/line.svg" alt="" />

  @if (currentDate ==
  this.dateFormatService.formatDateYYYYMMDD(channelMessage.createdAt)) {
  <span>Heute</span>
  } @else {
  <span>{{ this.dateFormatService.formatDate(channelMessage.createdAt) }}</span>
  }
</div>

<div
  class="content-message"
  [ngStyle]="{ 'flex-direction': isMessageFromYou ? 'row' : 'row-reverse' }"
  (mouseenter)="hovered = true; toggleReactionBar($event)"
  (mouseleave)="deleteHovered(); toggleReactionBar($event)"

>
  <div class="avatar pointer">
    <img src="{{ this.user.avatar }}" alt="" />
  </div>
  <div
    class="main"
    [ngStyle]="{ 'align-items': isMessageFromYou ? 'flex-start' : 'flex-end' }"
  >
    <div
      class="message-content pointer"
      [ngStyle]="{
        'align-items': isMessageFromYou ? 'flex-start' : 'flex-end'
      }"
    >
      <div
        class="creator-infos"
        [ngStyle]="{
          'flex-direction': isMessageFromYou ? 'row' : 'row-reverse'
        }"
      >
        <div class="creator" (click)="doNotClose($event)">
          {{ this.user.displayName }}
        </div>
        <div class="time">
          {{ this.dateFormatService.formatTime(channelMessage.createdAt) }}
          Uhr
        </div>
      </div>

      @if (isMessageFromYou) {
      <textarea
        class="message text-white"
        [ngStyle]="{
          'background-color': hovered ? '#797EF3' : '#797EF3',
          'border-radius': isMessageFromYou
            ? '0 30px 30px 30px'
            : '30px 0 30px 30px'
        }"
        [disabled]="isMessageDisabled"
        name=""
        id="{{ channelMessage.messageId }}"
        cols="30"
        rows="10"
        (change)="changeMessage($event)"
      >
      {{ channelMessage.text }}
      </textarea>
      } @else {
      <div
        class="message"
        [ngStyle]="{
          'background-color': hovered ? '#FFFFFF' : '#ECEEFE',
          'border-radius': isMessageFromYou
            ? '0 30px 30px 30px'
            : '30px 0 30px 30px'
        }"
      >
        {{ channelMessage.text }}
      </div>
      } @if (channelMessage.attachment) {
      <div class="attachment-list">
        @for (item of channelMessage.attachment; track $index) { @if(item !==
        'undefined' && item !== ''){
        <img class="attachment" src="{{ item }}" />
        } }
      </div>
      } @if(!isLoading && answerCount !== 0){
      <div
        class="thread-infos"
        [ngStyle]="{
          'flex-direction': isMessageFromYou ? 'row' : 'row-reverse'
        }"
      >
        <a href="#" (click)="doNotClose($event)">
          {{ this.answerCount }} Antworten</a
        >
        <span
          class="last-thread"
          [ngStyle]="{ color: hovered ? '#000000' : '#686868' }"
          >Letzte Antwort
          {{ this.dateFormatService.formatTime(this.lastAnswerTime) }}
        </span>
      </div>
      }
    </div>
    @if(channelMessage.reactions.length > 0){
    <div class="reaction-infos" (click)="doNotClose($event)">
      <div class="reactions">
        <ng-container *ngFor="let reaction of channelMessage.reactions">
          <div *ngIf="reaction.emoji" class="reaction-group pointer"
          (mouseenter)="showEmojiSnackbarStefan = true"
          (mouseleave)="showEmojiSnackbarStefan = false"
          >
            <span class="reaction-icon" (click)="toggleReaction(reaction)">{{
              reaction.emoji
            }}</span>
            <div class="reaction-count">
              {{ getUserReactionCount(reaction.emoji) }}
            </div>

            @if(showEmojiSnackbarStefan){
              <div class="reaction-snackbar">
                {{
                  reaction.emoji
                }}
              HARDCECODED hat reagiert
            </div>
          }

          </div>
        </ng-container>
      </div>
      <img
        *ngIf="channelMessage.reactions.length > 0"
        class="new-reaction pointer"
        src="./assets/img/emojis/add_reaction.svg"
        alt=""
        (click)="openEmojiPicker()"
      />
    </div>
    }
  </div>

  @if(showReactionBar){
  <div
    (click)="reactionBarAction($event); doNotClose($event)"
    class="reactionBar"
    [ngStyle]="{
      right: isMessageFromYou ? '5%' : 'unset',
      left: isMessageFromYou ? 'unset' : '5%'
    }"
  >
    <img src="./assets/img/emojis/check_mark.svg" alt="" />
    <img src="./assets/img/emojis/hands_up.svg" alt="" />
    <img
      src="./assets/img/emojis/add_reaction.svg"
      alt=""
      (click)="openEmojiPicker()"
    />
    <img src="./assets/img/emojis/answer.svg" alt="" />

    @if(isMessageFromYou){
    <img
      src="./assets/img/emojis/answer2.svg"
      alt=""
      (click)="toggleEditMessage($event); doNotClose($event)"
    />
    }
  </div>
  @if(showEditMessage){
  <div
    class="editMessageButton"
    [ngStyle]="{
      right: isMessageFromYou ? '5%' : 'unset',
      left: isMessageFromYou ? 'unset' : '5%'
    }"
  >
    <span (click)="editMessage($event, channelMessage.messageId)"> Nachricht bearbeiten </span>
  </div>
  } }
</div>
