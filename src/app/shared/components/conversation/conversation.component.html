<div class="timeSeperator">
  <img class="line" src="./assets/img/auth/line.svg" alt="" />

  @if (currentDate ==
  this.dateFormatService.formatDateYYYYMMDD(channelMessage.createdAt)) {
  <span>Heute</span>
  } @else {
  <span>{{ this.dateFormatService.formatDate(channelMessage.createdAt) }}</span>
  }
</div>

<div
  class="content-message"
  [ngStyle]="{ 'flex-direction': isMessageFromYou ? 'row' : 'row-reverse' }"
  (mouseenter)="hovered = true; toggleReactionBar($event)"
  (mouseleave)="deleteHovered(); toggleReactionBar($event)"
>
  <div class="avatar pointer">
    <img src="{{ this.user.avatar }}" alt="" />
  </div>
  <div
    class="main"
    [ngStyle]="{ 'align-items': isMessageFromYou ? 'flex-start' : 'flex-end' }"
  >
    <div
      class="message-content pointer"
      [ngStyle]="{
        'align-items': isMessageFromYou ? 'flex-start' : 'flex-end'
      }"
    >
      <div
        class="creator-infos"
        [ngStyle]="{
          'flex-direction': isMessageFromYou ? 'row' : 'row-reverse'
        }"
      >
        <div class="creator" (click)="doNotClose($event)">
          {{ this.user.displayName }}
        </div>
        <div class="time">
          {{ this.dateFormatService.formatTime(channelMessage.createdAt) }}
          Uhr
        </div>
      </div>

      @if (isMessageFromYou) {
      <form ngNativeValidate>
        <textarea
          class="message text-white"
          [ngStyle]="{
            'background-color': hovered ? '#797EF3' : '#797EF3',
            'border-radius': isMessageFromYou
              ? '0 30px 30px 30px'
              : '30px 0 30px 30px'
          }"
          [disabled]="isMessageDisabled"
          id="{{ channelMessage.messageId }}"
          #messageToEdit
          minlength="1"
          required
          (input)="adjustTextareaHeight(messageToEdit)"
          (change)="changeMessage(); adjustTextareaHeight(messageToEdit)"

          >{{ channelMessage.text }}</textarea
        >
        @if(!isMessageDisabled){
        <div class="edit-bar">
          <!-- NOTE Sacha Fragen, wie der Picker fÃ¼r die Textarea genutzt werden kann -->
          <!-- <img
            src="./assets/img/emojis/add_reaction.svg"
            alt=""
            (click)="openEmojiPicker()"
          /> -->
          <!-- NOTE Buttons verkleinern -->
          <div class="buttons">
            <button class="btn-secondary pointer" type="button" (click)="doNotClose($event);noChanges()">Abbrechen</button>
            <button class="btn-primary pointer" type="submit">Speichern</button>
          </div>
        </div>
        }
      </form>
      } @else {
      <textarea
        class="message"
        [ngStyle]="{
          'background-color': hovered ? '#FFFFFF' : '#ECEEFE',
          'border-radius': isMessageFromYou
            ? '0 30px 30px 30px'
            : '30px 0 30px 30px'
        }"
        #messageToEdit
        [disabled]="true"
        (input)="adjustTextareaHeight(messageToEdit)"
        (change)="adjustTextareaHeight(messageToEdit)"
        >{{ channelMessage.text }}</textarea
      >
      } @if (channelMessage.attachment) {
      <div class="attachment-list">
        @for (item of channelMessage.attachment; track $index) { @if(item !==
        'undefined' && item !== ''){
        <img class="attachment" src="{{ item }}" />
        } }
      </div>
      } @if(!isLoading && answerCount !== 0 && isChannel == true){
      <div
        class="thread-infos"
        [ngStyle]="{
          'flex-direction': isMessageFromYou ? 'row' : 'row-reverse'
        }"
      >
        <span class="answer" (click)="doNotClose($event); openThread()">{{ this.answerCount }} Antworten</span>
        <span
          class="last-thread"
          [ngStyle]="{ color: hovered ? '#000000' : '#686868' }"
          >Letzte Antwort
          {{ this.dateFormatService.formatTime(this.lastAnswerTime) }}
        </span>
      </div>
      }
    </div>
    @if(channelMessage.reactions.length > 0){
    <div class="reaction-infos" (click)="doNotClose($event)">
      <div class="reactions">
        <ng-container *ngFor="let reaction of channelMessage.reactions">
          <div
            *ngIf="reaction.emoji"
            class="reaction-group pointer"
            (mouseenter)="showEmojiSnackbarStefan = true"
            (mouseleave)="showEmojiSnackbarStefan = false"
          >
            <span class="reaction-icon" (click)="toggleReaction(reaction)">{{
              reaction.emoji
            }}</span>
            <div class="reaction-count">
              {{ getUserReactionCount(reaction.emoji) }}
            </div>

            @if(showEmojiSnackbarStefan){
            <div class="reaction-snackbar">
              {{ reaction.emoji }}
              HARDCECODED hat reagiert
            </div>
            }
          </div>
        </ng-container>
      </div>
      <img
        *ngIf="channelMessage.reactions.length > 0"
        class="new-reaction pointer"
        src="./assets/img/emojis/add_reaction.svg"
        alt=""
        (click)="openEmojiPicker()"
      />
    </div>
    }
  </div>

  @if(showReactionBar){
  <div
    class="reactionBar"
    [ngStyle]="{
      right: isMessageFromYou ? '5%' : 'unset',
      left: isMessageFromYou ? 'unset' : '5%'
    }"
  >
  
  @if(this.matchMedia.hideReactionIcons == false){
    <div class="reaction-icon-small">
      <img src="./assets/img/emojis/check_mark2.svg" alt=""  (click)="addEmojiReaction('âœ…')" />
    </div>
    <div class="reaction-icon-small">
      <img src="./assets/img/emojis/raised_hands.svg" alt="" (click)="addEmojiReaction('ðŸ™Œ')" />
    </div>
  }
  <img src="./assets/img/emojis/add_reaction.svg" alt="" (click)="openEmojiPicker()" />

  @if(isChannel == true && !isMessageFromYou){
    <img src="./assets/img/emojis/answer.svg" alt="" (click)="openThread()" />
  }

  @if(isMessageFromYou){
    <img src="./assets/img/emojis/answer2.svg" alt="" (click)="toggleEditMessage($event); doNotClose($event)" />
    }
  </div>
  @if(showEditMessage){
  <div
    class="editMessageButton"
    [ngStyle]="{
      right: isMessageFromYou ? '5%' : 'unset',
      left: isMessageFromYou ? 'unset' : '5%'
    }"
  >
    <span (click)="editMessage($event, channelMessage.messageId)">
      Nachricht bearbeiten
    </span>
  </div>
  } }
</div>
